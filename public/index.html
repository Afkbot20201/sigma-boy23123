<!doctype html><html><head><meta charset='utf-8'><title>Nemesis Chess</title>
<style>
body{margin:0;background:#0f172a;color:white;font-family:sans-serif}
#menu,#game{padding:20px}
.hidden{display:none}
.square{width:60px;height:60px;display:flex;align-items:center;justify-content:center;font-size:36px}
.light{background:#e5e7eb;color:#111}.dark{background:#4b5563}
#board{display:grid;grid-template:repeat(8,60px)/repeat(8,60px)}
#chat{height:120px;overflow:auto;border:1px solid #333;margin-top:6px}
</style></head><body>
<div id="menu">
<h2>Nemesis Chess</h2>
<input id="name" placeholder="Name"><br><br>
<button onclick="friend()">Play Friend</button>
<button onclick="ranked()">Ranked</button>
<button onclick="ai()">Vs AI</button><br><br>
<div id="friend" class="hidden">
<button onclick="create()">Create</button>
<input id="code" placeholder="Room">
<button onclick="join()">Join</button>
</div>
<div id="status"></div>
</div>

<div id="game" class="hidden">
<div>Turn: <span id="turn">-</span></div>
<div id="board"></div>
<div id="chat"></div>
<input id="msg"><button onclick="send()">Send</button>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const s=io();
const boardEl=document.getElementById("board");
const status=document.getElementById("status");
const menu=document.getElementById("menu");
const game=document.getElementById("game");
let room,myColor,myName,turn,selected;

function friend(){document.getElementById("friend").classList.remove("hidden");}
function ranked(){myName=name.value||"P";s.emit("rankedQueue",{name:myName});}
function ai(){myName=name.value||"P";s.emit("aiGame",{name:myName},joinCB);}
function create(){myName=name.value||"P";s.emit("create",{name:myName},r=>joinRoom(r.room));}
function join(){joinRoom(code.value);}

function joinRoom(c){myName=name.value||"P";s.emit("join",{room:c,name:myName},joinCB);}
function joinCB(r){
 if(!r.ok)return; room=r.room; myColor=r.color; turn=r.turn;
 menu.classList.add("hidden"); game.classList.remove("hidden");
 drawBoard(); render(r.fen);
}

function drawBoard(){
 boardEl.innerHTML="";
 const ranks=[8,7,6,5,4,3,2,1], files=["a","b","c","d","e","f","g","h"];
 for(const r of ranks)for(const f of files){
   const d=document.createElement("div");const sq=f+r;
   d.className="square "+(((r+f.charCodeAt(0))%2)?"dark":"light");
   d.dataset.sq=sq;d.onclick=()=>clickSq(d);boardEl.appendChild(d);
 }
}
function render(fen){
 const map={};const rows=fen.split(" ")[0].split("/");
 for(let i=0;i<8;i++){let f=1;for(const c of rows[i]){
   if(/\d/.test(c))f+=+c; else{map[String.fromCharCode(96+f)+(8-i)]=c;f++;}
 }}
 document.querySelectorAll(".square").forEach(d=>d.textContent=map[d.dataset.sq]||"");
}
function clickSq(d){
 if(myColor!==turn)return;
 if(!selected){selected=d.dataset.sq;return;}
 s.emit("move",{room,from:selected,to:d.dataset.sq},()=>{});
 selected=null;
}
s.on("state",st=>{turn=st.turn;document.getElementById("turn").textContent=turn;render(st.fen);});
function send(){s.emit("chat",{room,name:myName,msg:msg.value});msg.value="";}
s.on("chat",c=>{chat.innerHTML+=`<div>${c.name}: ${c.msg}</div>`;});
</script></body></html>